<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>k3s トークン :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/k3s/latest/ja/cli/token.html">
    <link rel="prev" href="secrets-encrypt.html">
    <link rel="next" href="../architecture.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<!-- <script src="/docserv/res/lightheaded/analytics.js"
        type="text/javascript"></script> -->
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a class=" navbar-logo" href="https://documentation.suse.com/" aria-label="SUSE Documentation Home"><img class="logo"
            src="../../../../_/img/logo.svg" alt="SUSE logo"/></a>
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">
            <img src="../../../../_/img/resources.png" class="langIcon Resurces" alt="Resources" title="Resources">
          </div>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/rancher/k3s-product-docs"><i class="fab fa-github"></i>&nbsp;K3s</a>
            <div class="has-submenu">
              <a class="navbar-item" href="#" ><i class="fas fa-file-alt"></i>&nbsp;Report Issue &nbsp;<i class="fas fa-chevron-right"></i></a>
              <div class="submenu">
                <a class="navbar-item" href="https://scc.suse.com">SCC (Recommended)</a>
                <a class="navbar-item" href="https://github.com/rancher/k3s-product-docs/issues">GitHub Issue</a>
              </div>
            </div>
            <a class="navbar-item" href="https://github.com/rancher/product-docs-playbook/blob/main/CONTRIBUTING.md"><i class="fas fa-user-edit"></i>&nbsp;Contribute</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link"><img src="../../../../_/img/language.png" class="langIcon Language" alt="Language"
              title="Language"></div>
          <div class="navbar-dropdown">
            <!--  </div><div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->
              <a role="button" class="navbar-item" id="en" onclick="selectLanguage(this.id)">
                <!--<img src="../../../../_/img/engFlag.svg" class="langIcon english">-->
                &nbsp;English
              </a>
              <a role="button" class="navbar-item" id="zh" onclick="selectLanguage(this.id)">
                <!--<img src="../../../../_/img/china.svg" class="langIcon china">-->
                &nbsp;中文
              </a>
              <a role="button" class="navbar-item" id="ko" onclick="selectLanguage(this.id)">
                <!--<img src="../../../../_/img/koFlag.svg" class="langIcon korea">-->
                &nbsp;한국어
              </a>
              <a role="button" class="navbar-item" id="ja" onclick="selectLanguage(this.id)">
                <!--<img src="../../../../_/img/jaFlag.svg" class="langIcon japan">-->
                &nbsp;日本語
              </a>
            <!-- LANGUAGESELECTOR -->
          </div>
        </div>
        <!--
        <div class="navbar-item">
          <a href="https://twitter.com/SUSE">
            <img alt="X-logo" class="x-logo" src="../../../../_/img/x-logo-white.png">
          </a>
        </div>
        -->
      </div>
    </div>

    <!--   <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">

        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
      </div> -->
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="k3s" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../../en/introduction.html">K3s</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">K3s - 軽量なKubernetes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../quick-start.html">クイックスタートガイド</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../installation/installation.html">インストール</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/requirements.html">要件</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/configuration.html">設定オプション</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/private-registry.html">プライベートレジストリの設定</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/registry-mirror.html">埋め込みレジストリミラー</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/airgap.html">エアギャップインストール</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/server-roles.html">サーバーロールの管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/packaged-components.html">パッケージ化されたコンポーネントの管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/uninstall.html">K3sのアンインストール</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../datastore/datastore.html">クラスタデータストア</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/backup-restore.html">バックアップとリストア</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/ha-embedded.html">高可用性組み込みetcd</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/ha.html">高可用性外部データベース</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/cluster-loadbalancer.html">クラスター・ロードバランサー</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../upgrades/upgrades.html">アップグレード</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/killall.html">K3sの停止</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/manual.html">手動アップグレード</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/automated.html">自動アップグレード</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../security/security.html">セキュリティ</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/secrets-encryption.html">secretの暗号化設定</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/hardening-guide.html">CIS ハードニングガイド</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/self-assessment-1.8.html">CIS 1.8 セルフアセスメントガイド</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/self-assessment-1.7.html">CIS 1.7 セルフアセスメントガイド</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/self-assessment-1.24.html">CIS 1.24 自己評価ガイド</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="cli.html">CLIツール</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="server.html">server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="agent.html">k3s エージェント</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="certificate.html">certificate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="etcd-snapshot.html">etcd-snapshot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="secrets-encrypt.html">secrets-encrypt</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="token.html">token</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture.html">アーキテクチャ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cluster-access.html">クラスターアクセス</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../storage.html">ボリュームとストレージ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../networking/networking.html">ネットワーキング</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/basic-network-options.html">基本的なネットワークオプション</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/distributed-multicloud.html">分散型ハイブリッドまたはマルチクラウドクラスター</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/multus-ipams.html">Multus and IPAM plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/networking-services.html">ネットワーキングサービス</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../helm.html">Helm</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced.html">高度なオプション / 設定</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/env-variables.html">環境変数</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/flag-deprecation.html">フラグの非推奨化</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/resource-profiling.html">リソースプロファイリング</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../related-projects.html">関連プロジェクト</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../known-issues.html">既知の問題</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../faq.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">K3s</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/v0.16/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.11/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../../en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/1.6/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../policy-manager/1.22/en/introduction.html">Policy Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../policy-manager/1.22/en/introduction.html">1.22-next</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.21/en/introduction.html">1.21</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.20/en/introduction.html">1.20</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.19/en/introduction.html">1.19</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.18/en/introduction.html">1.18</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.17/en/introduction.html">1.17</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.16/en/introduction.html">1.16</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/1.9.0/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../storage/1.9.0/en/longhorn-documentation.html">1.9.0 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8.0/en/longhorn-documentation.html">1.8.0 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.7.0/en/longhorn-documentation.html">1.7.0</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.4/en/introduction/overview.html">v1.4 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html" aria-label="Home" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../en/introduction.html">K3s</a></li>
    <li><a href="cli.html">CLIツール</a></li>
    <li><a href="token.html">token</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/rancher/k3s-product-docs/edit/main/versions/latest/modules/ja/pages/cli/token.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">k3s トークン</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>K3s uses tokens to secure the node join process and to encrypt confidential information that is persisted to the datastore。トークンはクラスターを参加ノードに認証し、ノードをクラスターに認証します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_トークン形式"><a class="anchor" href="#_トークン形式"></a>トークン形式</h2>
<div class="sectionbody">
<div class="paragraph">
<p>K3s トークンはセキュア形式またはショート形式で指定できます。セキュア形式が推奨されます。これは、クライアントが資格情報を送信する前に参加するクラスターのアイデンティティを認証できるためです。</p>
</div>
<div class="sect2">
<h3 id="_セキュア"><a class="anchor" href="#_セキュア"></a>セキュア</h3>
<div class="paragraph">
<p>セキュアトークン形式（「フル」トークンとも呼ばれることがあります）は、以下の部分で構成されます：</p>
</div>
<div class="paragraph">
<p><code>&lt;prefix&gt;&lt;cluster CA hash&gt;::&lt;credentials&gt;</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>prefix</code>: トークン形式を識別する固定の <code>K10</code> プレフィックス</p>
</li>
<li>
<p><code>cluster CA hash</code>: 参加ノードにサーバーを認証するために使用されるクラスターのサーバー CA 証明書のハッシュ。</p>
<div class="ulist">
<ul>
<li>
<p>自己署名 CA 証明書の場合、これはディスクに保存されている PEM 形式の証明書の SHA256 サムです。</p>
</li>
<li>
<p>カスタム CA 証明書の場合、これはルート証明書の DER エンコーディングの SHA256 サムです。一般に証明書のフィンガープリントとして知られています。</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>credentials</code>: クラスターに参加するノードを認証するために使用されるユーザー名とパスワード、またはベアラートークン。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_tls_ブートストラッピング"><a class="anchor" href="#_tls_ブートストラッピング"></a>TLS ブートストラッピング</h4>
<div class="paragraph">
<p>セキュアトークンが指定されている場合、参加ノードは資格情報を送信する前に接続したサーバーのアイデンティティを検証するために以下の手順を実行します：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>TLS 検証を無効にして、参加するサーバーの <code>/cacerts</code> から CA バンドルをダウンロードします。</p>
</li>
<li>
<p>上記の説明に従って CA 証明書の SHA256 ハッシュを計算します。</p>
</li>
<li>
<p>計算された SHA256 ハッシュをトークンのハッシュと比較します。</p>
</li>
<li>
<p>ハッシュが一致する場合、サーバーが提示する証明書がサーバーの CA バンドルによって検証できることを確認します。</p>
</li>
<li>
<p>サーバー証明書が有効である場合、トークンの種類に応じて基本認証またはベアラートークン認証を使用してクラスターに参加するための資格情報を提示します。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ショート"><a class="anchor" href="#_ショート"></a>ショート</h3>
<div class="paragraph">
<p>ショートトークン形式には、クラスターに参加するノードを認証するために使用されるパスワードまたはベアラートークンのみが含まれます。</p>
</div>
<div class="paragraph">
<p>ショートトークンが使用される場合、参加ノードはサーバーが提示する CA バンドルを暗黙的に信頼します。TLS ブートストラッピングプロセスのステップ 2-4 はスキップされます。初回接続は<a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">中間者攻撃</a>に対して脆弱である可能性があります。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_トークンの種類"><a class="anchor" href="#_トークンの種類"></a>トークンの種類</h2>
<div class="sectionbody">
<div class="paragraph">
<p>K3s は 3 種類のトークンをサポートします。デフォルトではサーバートークンのみが利用可能で、追加のトークンタイプは管理者によって設定または作成される必要があります。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">種類</th>
<th class="tableblock halign-left valign-top">CLI オプション</th>
<th class="tableblock halign-left valign-top">環境変数</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--token</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>K3S_TOKEN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">エージェント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--agent-token</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>K3S_AGENT_TOKEN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブートストラップ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>n/a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>n/a</code></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_サーバー"><a class="anchor" href="#_サーバー"></a>サーバー</h3>
<div class="paragraph">
<p>クラスターの最初のサーバーを起動する際にトークンが提供されない場合、ランダムなパスワードでトークンが作成されます。サーバートークンは常にセキュア形式で <code>/var/lib/rancher/k3s/server/token</code> に書き込まれます。</p>
</div>
<div class="paragraph">
<p>The server token can be used to join both server and agent nodes to the cluster. Anyone with access to the server token essentially has full administrator access to the cluster. This token should be guarded carefully.</p>
</div>
<div class="paragraph">
<p>The server token is also used as the <a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> passphrase to encrypt confidential information that is persisted to the datastore known as bootstrap data. Bootstrap data is essential to set up new server nodes or restore from a snapshot. For this reason, the token must be backed up alongside the cluster datastore itself.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>カスタム CA 証明書が使用されていない限り、クラスターの最初のサーバーを起動する際にはショート（パスワードのみ）トークン形式のみが使用できます。これは、サーバーが自己署名のクラスター CA 証明書を生成するまでクラスター CA ハッシュがわからないためです。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>カスタム CA 証明書の使用に関する詳細は、<a href="certificate.html" class="xref page"><code>k3s certificate</code> ドキュメント</a>を参照してください。<br>
クラスターのバックアップに関する詳細は、<a href="../datastore/backup-restore.html" class="xref page">バックアップとリストア</a>ドキュメントを参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="_エージェント"><a class="anchor" href="#_エージェント"></a>エージェント</h3>
<div class="paragraph">
<p>デフォルトでは、エージェントトークンはサーバートークンと同じです。エージェントトークンは、クラスターが開始された後でも、すべてのサーバーの CLI オプションまたは環境変数を変更することで設定できます。エージェントトークンはサーバートークンと同様に静的に構成され、期限切れにはなりません。</p>
</div>
<div class="paragraph">
<p>エージェントトークンはセキュア形式で <code>/var/lib/rancher/k3s/server/agent-token</code> に書き込まれます。エージェントトークンが指定されていない場合、このファイルはサーバートークンへのリンクです。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ブートストラップ"><a class="anchor" href="#_ブートストラップ"></a>ブートストラップ</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">バージョンゲート</div>
<div class="paragraph">
<p><code>k3s token</code> コマンドのサポートとブートストラップトークンを使用してノードに参加する機能は、2023-02 リリース（v1.26.2+k3s1、v1.25.7+k3s1、v1.24.11+k3s1、v1.23.17+k3s1）から利用可能です。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>K3s supports dynamically generated, automatically expiring agent <a href="https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/">bootstrap tokens</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_k3s_トークン"><a class="anchor" href="#_k3s_トークン"></a>k3s トークン</h2>
<div class="sectionbody">
<div class="paragraph">
<p>K3s ブートストラップトークンは <code>kubeadm token</code> ブートストラップトークンと同じ生成および検証コードを使用し、<code>k3s token</code> CLI も類似しています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME:
   k3s token - ブートストラップトークンを管理する

USAGE:
   k3s token command [command options] [arguments...]

COMMANDS:
   create    サーバー上でブートストラップトークンを作成する
   delete    サーバー上のブートストラップトークンを削除する
   generate  ブートストラップトークンを生成して表示するが、サーバー上には作成しない
   list      サーバー上のブートストラップトークンを一覧表示する
   rotate    元のサーバートークンを新しいブートストラップトークンにローテートする

OPTIONS:
   --help, -h  ヘルプを表示する</pre>
</div>
</div>
<div class="sect2">
<h3 id="_k3s_token_create_token"><a class="anchor" href="#_k3s_token_create_token"></a><code>k3s token create [token]</code></h3>
<div class="paragraph">
<p>新しいトークンを作成します。<code>[token]</code> は <code>k3s token generate</code> によって生成された実際のトークンです。トークンが指定されていない場合、ランダムなトークンが生成されます。</p>
</div>
<div class="paragraph">
<p>クラスター CA ハッシュを含むセキュア形式のトークンが標準出力に書き込まれます。このコマンドの出力は保存する必要があります。トークンの秘密部分は再度表示できません。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">フラグ</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--data-dir</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">状態を保持するフォルダー（デフォルト: /var/lib/rancher/k3s または root でない場合は ${HOME}/.rancher/k3s）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kubeconfig</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">接続するサーバー [$KUBECONFIG]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--description</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このトークンの使用方法に関する人間に優しい説明</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--groups</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">認証に使用されるときにこのトークンが認証する追加のグループ。（デフォルト: "system:bootstrappers:k3s:default-node-token"）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--ttl</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">トークンが自動的に削除されるまでの期間（例: 1s, 2m, 3h）。'0' に設定すると、トークンは期限切れになりません（デフォルト: 24h0m0s）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--usages</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このトークンが使用できる方法を説明します。（デフォルト: "signing,authentication"）</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_k3s_token_delete"><a class="anchor" href="#_k3s_token_delete"></a><code>k3s token delete</code></h3>
<div class="paragraph">
<p>1 つ以上のトークンを削除します。完全なトークンまたはトークン ID のみを提供できます。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">フラグ</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--data-dir</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">状態を保持するフォルダー（デフォルト: /var/lib/rancher/k3s または root でない場合は ${HOME}/.rancher/k3s）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kubeconfig</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">接続するサーバー [$KUBECONFIG]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_k3s_token_generate"><a class="anchor" href="#_k3s_token_generate"></a><code>k3s token generate</code></h3>
<div class="paragraph">
<p>ランダムに生成されたブートストラップトークンを生成します。</p>
</div>
<div class="paragraph">
<p>トークンを生成するためにこのコマンドを使用する必要はありません。トークン ID が <code>[a-z0-9]{6}.[a-z0-9]{16}</code> の形式であり、最初の部分がトークン ID、2 番目の部分が秘密である限り、自分で生成することもできます。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">フラグ</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--data-dir</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">状態を保持するフォルダー（デフォルト: /var/lib/rancher/k3s または root でない場合は ${HOME}/.rancher/k3s）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kubeconfig</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">接続するサーバー [$KUBECONFIG]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_k3s_token_list"><a class="anchor" href="#_k3s_token_list"></a><code>k3s token list</code></h3>
<div class="paragraph">
<p>ブートストラップトークンを一覧表示し、その ID、説明、および残りの有効期間を表示します。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">フラグ</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--data-dir</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">状態を保持するフォルダー（デフォルト: /var/lib/rancher/k3s または root でない場合は ${HOME}/.rancher/k3s）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kubeconfig</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">接続するサーバー [$KUBECONFIG]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--output</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">出力形式。 有効なオプション: text, json（デフォルト: "text"）</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_k3s_token_rotate"><a class="anchor" href="#_k3s_token_rotate"></a><code>k3s token rotate</code></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">バージョンゲート</div>
<div class="paragraph">
<p>2023年10月のリリース（v1.28.2+k3s1、v1.27.7+k3s1、v1.26.10+k3s1、v1.25.15+k3s1）から利用可能です。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Rotate original server token with a new server token.
元のサーバートークンを新しいブートストラップトークンにローテートします。このコマンドを実行した後、すべてのサーバーおよび元のトークンで参加したエージェントは新しいトークンで再起動する必要があります。</p>
</div>
<div class="paragraph">
<p>新しいトークンを指定しない場合、1 つが生成されます。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">フラグ</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--data-dir</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">状態を保持するフォルダー（デフォルト: /var/lib/rancher/k3s または root でない場合は ${HOME}/.rancher/k3s）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kubeconfig</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">接続するサーバー [$KUBECONFIG]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">接続するサーバー(デフォルト: "https://127.0.0.1:6443") [$K3S_URL]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--token</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバーまたはエージェントをクラスターに参加させるために使用される既存のトークン [$K3S_TOKEN]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--new-token</code> 値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">既存のトークンを置き換える新しいトークン</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Snapshots taken before the rotation will require the old server token when restoring the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="secrets-encrypt.html">secrets-encrypt</a></span>
  <span class="next"><a href="../architecture.html">アーキテクチャ</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


  </body>
</html>
