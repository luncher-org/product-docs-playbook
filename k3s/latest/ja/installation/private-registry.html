<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>プライベートレジストリの設定 :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/k3s/latest/ja/installation/private-registry.html">
    <link rel="prev" href="configuration.html">
    <link rel="next" href="registry-mirror.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<!-- <script src="/docserv/res/lightheaded/analytics.js"
        type="text/javascript"></script> -->
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a class=" navbar-logo" href="https://documentation.suse.com/" aria-label="SUSE Documentation Home"><img class="logo"
            src="../../../../_/img/logo.svg" alt="SUSE logo"/></a>
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">
            <img src="../../../../_/img/resources.png" class="langIcon Resurces" alt="Resources" title="Resources">
          </div>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/rancher/k3s-product-docs"><i class="fab fa-github"></i>&nbsp;K3s</a>
            <div class="has-submenu">
              <a class="navbar-item" href="#" ><i class="fas fa-file-alt"></i>&nbsp;Report Issue &nbsp;<i class="fas fa-chevron-right"></i></a>
              <div class="submenu">
                <a class="navbar-item" href="https://scc.suse.com">SCC (Recommended)</a>
                <a class="navbar-item" href="https://github.com/rancher/k3s-product-docs/issues">GitHub Issue</a>
              </div>
            </div>
            <a class="navbar-item" href="https://github.com/rancher/product-docs-playbook/blob/main/CONTRIBUTING.md"><i class="fas fa-user-edit"></i>&nbsp;Contribute</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link"><img src="../../../../_/img/language.png" class="langIcon Language" alt="Language"
              title="Language"></div>
          <div class="navbar-dropdown">
            <!--  </div><div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->
              <a role="button" class="navbar-item" id="en" onclick="selectLanguage(this.id)">
                <!--<img src="../../../../_/img/engFlag.svg" class="langIcon english">-->
                &nbsp;English
              </a>
              <a role="button" class="navbar-item" id="zh" onclick="selectLanguage(this.id)">
                <!--<img src="../../../../_/img/china.svg" class="langIcon china">-->
                &nbsp;中文
              </a>
              <a role="button" class="navbar-item" id="ko" onclick="selectLanguage(this.id)">
                <!--<img src="../../../../_/img/koFlag.svg" class="langIcon korea">-->
                &nbsp;한국어
              </a>
              <a role="button" class="navbar-item" id="ja" onclick="selectLanguage(this.id)">
                <!--<img src="../../../../_/img/jaFlag.svg" class="langIcon japan">-->
                &nbsp;日本語
              </a>
            <!-- LANGUAGESELECTOR -->
          </div>
        </div>
        <!--
        <div class="navbar-item">
          <a href="https://twitter.com/SUSE">
            <img alt="X-logo" class="x-logo" src="../../../../_/img/x-logo-white.png">
          </a>
        </div>
        -->
      </div>
    </div>

    <!--   <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">

        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
      </div> -->
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="k3s" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../../en/introduction.html">K3s</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">K3s - 軽量なKubernetes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../quick-start.html">クイックスタートガイド</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="installation.html">インストール</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="requirements.html">要件</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration.html">設定オプション</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="private-registry.html">プライベートレジストリの設定</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="registry-mirror.html">埋め込みレジストリミラー</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="airgap.html">エアギャップインストール</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="server-roles.html">サーバーロールの管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="packaged-components.html">パッケージ化されたコンポーネントの管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="uninstall.html">K3sのアンインストール</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../datastore/datastore.html">クラスタデータストア</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/backup-restore.html">バックアップとリストア</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/ha-embedded.html">高可用性組み込みetcd</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/ha.html">高可用性外部データベース</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/cluster-loadbalancer.html">クラスター・ロードバランサー</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../upgrades/upgrades.html">アップグレード</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/killall.html">K3sの停止</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/manual.html">手動アップグレード</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/automated.html">自動アップグレード</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../security/security.html">セキュリティ</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/secrets-encryption.html">secretの暗号化設定</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/hardening-guide.html">CIS ハードニングガイド</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/self-assessment-1.8.html">CIS 1.8 セルフアセスメントガイド</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/self-assessment-1.7.html">CIS 1.7 セルフアセスメントガイド</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/self-assessment-1.24.html">CIS 1.24 自己評価ガイド</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../cli/cli.html">CLIツール</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/server.html">server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/agent.html">k3s エージェント</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/certificate.html">certificate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/etcd-snapshot.html">etcd-snapshot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/secrets-encrypt.html">secrets-encrypt</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/token.html">token</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture.html">アーキテクチャ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cluster-access.html">クラスターアクセス</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../storage.html">ボリュームとストレージ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../networking/networking.html">ネットワーキング</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/basic-network-options.html">基本的なネットワークオプション</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/distributed-multicloud.html">分散型ハイブリッドまたはマルチクラウドクラスター</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/multus-ipams.html">Multus and IPAM plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/networking-services.html">ネットワーキングサービス</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../helm.html">Helm</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced.html">高度なオプション / 設定</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/env-variables.html">環境変数</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/flag-deprecation.html">フラグの非推奨化</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/resource-profiling.html">リソースプロファイリング</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../related-projects.html">関連プロジェクト</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../known-issues.html">既知の問題</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../faq.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">K3s</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/v0.16/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.11/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../../en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/1.6/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../policy-manager/1.22/en/introduction.html">Policy Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../policy-manager/1.22/en/introduction.html">1.22-next</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.21/en/introduction.html">1.21</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.20/en/introduction.html">1.20</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.19/en/introduction.html">1.19</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.18/en/introduction.html">1.18</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.17/en/introduction.html">1.17</a>
            </li>
            <li class="version">
              <a href="../../../../policy-manager/1.16/en/introduction.html">1.16</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/1.9.0/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../storage/1.9.0/en/longhorn-documentation.html">1.9.0 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8.0/en/longhorn-documentation.html">1.8.0 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.7.0/en/longhorn-documentation.html">1.7.0</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.4/en/introduction/overview.html">v1.4 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html" aria-label="Home" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../en/introduction.html">K3s</a></li>
    <li><a href="installation.html">インストール</a></li>
    <li><a href="private-registry.html">プライベートレジストリの設定</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/rancher/k3s-product-docs/edit/main/versions/latest/modules/ja/pages/installation/private-registry.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">プライベートレジストリの設定</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Containerdはプライベートレジストリに接続し、kubeletが必要とするイメージをプルするために使用するように設定できます。</p>
</div>
<div class="paragraph">
<p>起動時に、K3sは<code>/etc/rancher/k3s/registries.yaml</code>が存在するかどうかを確認します。存在する場合、このファイルに含まれるレジストリ設定がcontainerd設定の生成時に使用されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>docker.ioのようなパブリックレジストリのミラーとしてプライベートレジストリを使用したい場合、そのミラーを使用する各ノードに<code>registries.yaml</code>を設定する必要があります。</p>
</li>
<li>
<p>プライベートレジストリが認証を必要とする場合、カスタムTLS証明書を使用する場合、またはTLSを使用しない場合、イメージをプルする各ノードに<code>registries.yaml</code>を設定する必要があります。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>サーバーノードはデフォルトでスケジュール可能であることに注意してください。サーバーノードに汚染を設定しておらず、ワークロードを実行する場合は、各サーバーにも<code>registries.yaml</code>ファイルを作成することを確認してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_default_endpoint_fallback"><a class="anchor" href="#_default_endpoint_fallback"></a>デフォルトエンドポイントのフォールバック</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Containerdにはすべてのレジストリに対して暗黙の「デフォルトエンドポイント」があります。
デフォルトエンドポイントは、<code>registries.yaml</code>にそのレジストリの他のエンドポイントがリストされている場合でも、最後の手段として常に試されます。
Rewrites are not applied to pulls against the default endpoint.
例えば、<code>registry.example.com:5000/rancher/mirrored-pause:3.6</code>をプルする場合、containerdは<code>https://registry.example.com:5000/v2</code>のデフォルトエンドポイントを使用します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>docker.io</code>のデフォルトエンドポイントは<code>https://index.docker.io/v2</code>です。</p>
</li>
<li>
<p>他のすべてのレジストリのデフォルトエンドポイントは<code><a href="https://&lt;REGISTRY&gt;/v2" class="bare">https://&lt;REGISTRY&gt;/v2</a></code>です。<code>&lt;REGISTRY&gt;</code>はレジストリのホスト名とオプションのポートです。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>レジストリとして認識されるためには、イメージ名の最初のコンポーネントに少なくとも1つのピリオドまたはコロンが含まれている必要があります。
歴史的な理由から、名前にレジストリが指定されていないイメージは暗黙的に<code>docker.io</code>からのものと見なされます。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">バージョンゲート</div>
<div class="paragraph">
<p><code>--disable-default-registry-endpoint</code>オプションは2024年1月のリリースから実験的機能として利用可能です：v1.26.13+k3s1、v1.27.10+k3s1、v1.28.6+k3s1、v1.29.1+k3s1</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ノードは<code>--disable-default-registry-endpoint</code>オプションを設定して起動できます。
このオプションが設定されている場合、containerdはデフォルトのレジストリエンドポイントにフォールバックせず、設定されたミラーエンドポイントと、分散レジストリが有効になっている場合はそれを使用してのみプルします。</p>
</div>
<div class="paragraph">
<p>これは、クラスターが上流のレジストリが利用できない真のエアギャップ環境にある場合や、一部のノードのみが上流のレジストリからプルすることを希望する場合に望ましいかもしれません。</p>
</div>
<div class="paragraph">
<p>デフォルトのレジストリエンドポイントの無効化は、<code>registries.yaml</code>を介して設定されたレジストリにのみ適用されます。
レジストリが<code>registries.yaml</code>のミラーエントリを介して明示的に設定されていない場合、デフォルトのフォールバック動作は引き続き使用されます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_レジストリ設定ファイル"><a class="anchor" href="#_レジストリ設定ファイル"></a>レジストリ設定ファイル</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ファイルは2つのトップレベルキーで構成され、それぞれのレジストリに対してサブキーがあります：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  &lt;REGISTRY&gt;:
    endpoint:
      - https://&lt;REGISTRY&gt;/v2
configs:
  &lt;REGISTRY&gt;:
    auth:
      username: &lt;BASIC AUTH USERNAME&gt;
      password: &lt;BASIC AUTH PASSWORD&gt;
      token: &lt;BEARER TOKEN&gt;
    tls:
      ca_file: &lt;PATH TO SERVER CA&gt;
      cert_file: &lt;PATH TO CLIENT CERT&gt;
      key_file: &lt;PATH TO CLIENT KEY&gt;
      insecure_skip_verify: &lt;SKIP TLS CERT VERIFICATION BOOLEAN&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_ミラー"><a class="anchor" href="#_ミラー"></a>ミラー</h3>
<div class="paragraph">
<p>ミラーセクションはレジストリの名前とエンドポイントを定義します。例えば：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mirrors:
  registry.example.com:
    endpoint:
      - "https://registry.example.com:5000"</pre>
</div>
</div>
<div class="paragraph">
<p>各ミラーには名前とエンドポイントのセットが必要です。レジストリからイメージをプルする際、containerdはこれらのエンドポイントURLとデフォルトエンドポイントを試し、最初に動作するものを使用します。</p>
</div>
<div class="sect3">
<h4 id="_リダイレクト"><a class="anchor" href="#_リダイレクト"></a>リダイレクト</h4>
<div class="paragraph">
<p>プライベートレジストリが他のレジストリのミラーとして使用される場合、例えば<a href="https://docs.docker.com/registry/recipes/mirror/">プルスルーキャッシュ</a>を設定する場合、
イメージプルはリストされたエンドポイントに透過的にリダイレクトされます。元のレジストリ名は<code>ns</code>クエリパラメータを介してミラーエンドポイントに渡されます。</p>
</div>
<div class="paragraph">
<p>例えば、<code>docker.io</code>のミラーを設定している場合：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  docker.io:
    endpoint:
      - "https://registry.example.com:5000"</code></pre>
</div>
</div>
<div class="paragraph">
<p>この場合、<code>docker.io/rancher/mirrored-pause:3.6</code>をプルすると、透過的に<code>registry.example.com:5000/rancher/mirrored-pause:3.6</code>としてイメージがプルされます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_リライト"><a class="anchor" href="#_リライト"></a>リライト</h4>
<div class="paragraph">
<p>Each mirror can have a set of rewrites, which use regular expressions to match and transform the name of an image when it is pulled from a mirror.
これは、プライベートレジストリの組織/プロジェクト構造がミラーリングしているレジストリと異なる場合に便利です。
Rewrites match and transform only the image name, NOT the tag.</p>
</div>
<div class="paragraph">
<p>例えば、次の設定は、<code>docker.io/rancher/mirrored-pause:3.6</code>のイメージを透過的に<code>registry.example.com:5000/mirrorproject/rancher-images/mirrored-pause:3.6</code>としてプルします：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  docker.io:
    endpoint:
      - "https://registry.example.com:5000"
    rewrite:
      "^rancher/(.*)": "mirrorproject/rancher-images/$1"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Version Gate</div>
<div class="paragraph">
<p>Rewrites are no longer applied to the <a href="#_default_endpoint_fallback">Default Endpoint</a> as of the January 2024 releases: v1.26.13+k3s1, v1.27.10+k3s1, v1.28.6+k3s1, v1.29.1+k3s1.
Prior to these releases, rewrites were also applied to the default endpoint, which would prevent K3s from pulling from the upstream registry if the image could not be pulled from a mirror endpoint, and the image was not available under the modified name in the upstream.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to apply rewrites when pulling directly from a registry - when it is not being used as a mirror for a different upstream registry - you must provide a mirror endpoint that does not match the default endpoint.
Mirror endpoints in <code>registries.yaml</code> that match the default endpoint are ignored; the default endpoint is always tried last with no rewrites, if fallback has not been disabled.</p>
</div>
<div class="paragraph">
<p>For example, if you have a registry at <code>https://registry.example.com/</code>, and want to apply rewrites when explicitly pulling <code>registry.example.com/rancher/mirrored-pause:3.6</code>, you can add a mirror endpoint with the port listed.
Because the mirror endpoint does not match the default endpoint - <strong><code>"https://registry.example.com:443/v2" != "https://registry.example.com/v2"</code></strong> - the endpoint is accepted as a mirror and rewrites are applied, despite it being effectively the same as the default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
 registry.example.com
   endpoint:
     - "https://registry.example.com:443"
   rewrites:
     "^rancher/(.*)": "mirrorproject/rancher-images/$1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that when using mirrors and rewrites, images will still be stored under the original name.
For example, <code>crictl image ls</code> will show <code>docker.io/rancher/mirrored-pause:3.6</code> as available on the node, even if the image was pulled from a mirror with a different name.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_設定"><a class="anchor" href="#_設定"></a>設定</h3>
<div class="paragraph">
<p><code>configs</code>セクションは各ミラーのTLSおよび認証設定を定義します。各ミラーに対して<code>auth</code>および/または<code>tls</code>を定義できます。</p>
</div>
<div class="paragraph">
<p><code>tls</code>部分は以下のように構成されます：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ディレクティブ</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cert_file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">レジストリと認証するために使用されるクライアント証明書のパス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key_file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">レジストリと認証するために使用されるクライアントキーのパス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca_file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">レジストリのサーバー証明書ファイルを検証するために使用されるCA証明書のパス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>insecure_skip_verify</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">レジストリのTLS検証をスキップするかどうかを定義するブール値</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>auth</code>部分はユーザー名/パスワードまたは認証トークンのいずれかで構成されます：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ディレクティブ</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プライベートレジストリの基本認証のユーザー名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プライベートレジストリの基本認証のユーザーパスワード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プライベートレジストリの基本認証の認証トークン</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>以下は、異なるモードでプライベートレジストリを使用する基本的な例です：</p>
</div>
</div>
<div class="sect2">
<h3 id="_ワイルドカードサポート"><a class="anchor" href="#_ワイルドカードサポート"></a>ワイルドカードサポート</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">バージョンゲート</div>
<div class="paragraph">
<p>ワイルドカードサポートは2024年3月のリリースから利用可能です：v1.26.15+k3s1、v1.27.12+k3s1、v1.28.8+k3s1、v1.29.3+k3s1</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>mirrors</code>および<code>configs</code>セクションで<code>"*"</code>ワイルドカードエントリを使用して、すべてのレジストリに対するデフォルト設定を提供できます。
デフォルト設定は、そのレジストリに特定のエントリがない場合にのみ使用されます。アスタリスクは必ず引用符で囲む必要があります。</p>
</div>
<div class="paragraph">
<p>以下の例では、すべてのレジストリに対してローカルレジストリミラーが使用されます。<code>docker.io</code>を除くすべてのレジストリに対してTLS検証が無効になります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  "*":
    endpoint:
      - "https://registry.example.com:5000"
configs:
  "docker.io":
  "*":
    tls:
      insecure_skip_verify: true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tlsを使用する場合"><a class="anchor" href="#_tlsを使用する場合"></a>TLSを使用する場合</h3>
<div class="paragraph">
<p>以下は、TLSを使用する場合に各ノードで<code>/etc/rancher/k3s/registries.yaml</code>を設定する方法を示す例です。</p>
</div>
<div id="_tabs_1" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_認証あり" class="tab">
<p>認証あり</p>
</li>
<li id="_tabs_1_認証なし" class="tab">
<p>認証なし</p>
</li>
</ul>
</div>
<div id="_tabs_1_認証あり--panel" class="tabpanel" aria-labelledby="_tabs_1_認証あり">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  docker.io:
    endpoint:
      - "https://registry.example.com:5000"
configs:
  "registry.example.com:5000":
    auth:
      username: xxxxxx # これはレジストリのユーザー名です
      password: xxxxxx # これはレジストリのパスワードです
    tls:
      cert_file: # レジストリで使用される証明書ファイルのパス
      key_file:  # レジストリで使用されるキーのパス
      ca_file:   # レジストリで使用されるCAファイルのパス</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_認証なし--panel" class="tabpanel" aria-labelledby="_tabs_1_認証なし">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  docker.io:
    endpoint:
      - "https://registry.example.com:5000"
configs:
  "registry.example.com:5000":
    tls:
      cert_file: # レジストリで使用される証明書ファイルのパス
      key_file:  # レジストリで使用されるキーのパス
      ca_file:   # レジストリで使用されるCAファイルのパス</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tlsを使用しない場合"><a class="anchor" href="#_tlsを使用しない場合"></a>TLSを使用しない場合</h3>
<div class="paragraph">
<p>以下は、TLSを使用しない場合に各ノードで<code>/etc/rancher/k3s/registries.yaml</code>を設定する方法を示す例です。</p>
</div>
<div id="_tabs_2" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_認証あり" class="tab">
<p>認証あり</p>
</li>
<li id="_tabs_2_認証なし" class="tab">
<p>認証なし</p>
</li>
</ul>
</div>
<div id="_tabs_2_認証あり--panel" class="tabpanel" aria-labelledby="_tabs_2_認証あり">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  docker.io:
    endpoint:
      - "http://registry.example.com:5000"
configs:
  "registry.example.com:5000":
    auth:
      username: xxxxxx # これはレジストリのユーザー名です
      password: xxxxxx # これはレジストリのパスワードです</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_認証なし--panel" class="tabpanel" aria-labelledby="_tabs_2_認証なし">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  docker.io:
    endpoint:
      - "http://registry.example.com:5000"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>TLS通信がない場合、エンドポイントに<code>http://</code>を指定する必要があります。そうしないと、デフォルトでhttpsになります。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>レジストリの変更を有効にするためには、各ノードでK3sを再起動する必要があります。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_イメージプルのトラブルシューティング"><a class="anchor" href="#_イメージプルのトラブルシューティング"></a>イメージプルのトラブルシューティング</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kubernetesがイメージのプルに問題を抱えている場合、kubeletによって表示されるエラーは、デフォルトエンドポイントに対して行われたプル試行から返された最終エラーのみを反映することがあり、設定されたエンドポイントが使用されていないように見えることがあります。</p>
</div>
<div class="paragraph">
<p>ノードの<code>/var/lib/rancher/k3s/agent/containerd/containerd.log</code>にあるcontainerdログを確認して、失敗の根本原因に関する詳細情報を確認してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_プライベートレジストリへのイメージの追加"><a class="anchor" href="#_プライベートレジストリへのイメージの追加"></a>プライベートレジストリへのイメージの追加</h2>
<div class="sectionbody">
<div class="paragraph">
<p>プライベートレジストリにイメージをミラーリングするには、イメージをプルおよびプッシュできるDockerまたは他のサードパーティツールを備えたホストが必要です。
以下の手順は、dockerdとdocker CLIツール、およびdocker.ioとプライベートレジストリの両方にアクセスできるホストがあることを前提としています。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>作業しているリリースのGitHubから<code>k3s-images.txt</code>ファイルを取得します。</p>
</li>
<li>
<p><code>k3s-images.txt</code>ファイルにリストされている各K3sイメージをdocker.ioからプルします。<br>
例：<code>docker pull docker.io/rancher/mirrored-pause:3.6</code></p>
</li>
<li>
<p>イメージをプライベートレジストリに再タグ付けします。</p>
<div class="paragraph">
<p>例: <code>docker tag docker.io/rancher/mirrored-pause:3.6 registry.example.com:5000/rancher/mirrored-pause:3.6</code></p>
</div>
</li>
<li>
<p>イメージをプライベートレジストリにプッシュします。<br>
例: <code>docker push registry.example.com:5000/rancher/mirrored-pause:3.6</code></p>
</li>
</ol>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="configuration.html">設定オプション</a></span>
  <span class="next"><a href="registry-mirror.html">埋め込みレジストリミラー</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


  </body>
</html>
